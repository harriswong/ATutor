var fluid=fluid||{};var swfObj={};(function(g,c){var j={};var Z=Z||{};var V={uploadUrl:"",flashUrl:"",fileSizeLimit:"20480",fileTypes:"*.*",fileTypesText:"image files",fileUploadLimit:0,fileQueueLimit:0,elmUploader:"#single-inline-fluid-uploader",elmUploaderControl:"",whenDone:"",whenCancel:"",postParams:{},httpUploadElm:"",continueAfterUpload:true,dialogDisplay:false,queueListMaxHeight:200,debug:false};var D={elmUploadContainer:".fluid-uploader",elmUpload:".fluid-uploader-upload",elmPause:".fluid-uploader-pause",elmBrowse:".fluid-uploader-browse",elmDone:".fluid-uploader-done",elmCancel:".fluid-uploader-cancel",elmFileQueue:".fluid-uploader-queue",elmEmptyRow:".fluid-uploader-row-placeholder",txtTotalFiles:".fluid-uploader-totalFiles",txtTotalBytes:".fluid-uploader-totalBytes",osModifierKey:".fluid-uploader-modifierKey",txtFileStatus:".fileStatus",progress:".fluid-progress",fileProgress:".file-progress",totalProgress:".total-progress"};var f={totalBytes:0,totalCount:0,currCount:0,currTotalBytes:0,currError:"",stop:false};var b={macControlKey:"Command",browseText:"Browse"+unescape("%u2026"),addMoreText:"Browse"+unescape("%u2026"),fileUploaded:"File Uploaded"};var O=function(p){p.fadeOut("fast",function(){var q=p.attr("id");var r=swfObj.getFile(q);k(-r.size);f.totalCount--;swfObj.cancelUpload(q);p.remove();G();n();Q();S()});return p};var G=function(){g(D.txtTotalFiles).text(T())};var Q=function(){g(D.txtTotalBytes).text(a(k()))};var n=function(p){if(p===undefined){p=(o()>0)?"loaded":"empty"}g(Z.elmUploader+" > div").attr("className",p)};var S=function(){if(f.totalCount>0){g(D.elmBrowse).text(b.addMoreText)}else{g(D.elmBrowse).text(b.browseText)}};var U=function(p){p.addClass("dim");I(p,b.fileUploaded)};var I=function(q,p){g(q).children(D.txtFileStatus).text(p)};var Y=function(p){if(p!==undefined){if(typeof p==="function"){p()}else{location.href=p}}};var F=function(){swfObj.startUpload()};function R(q){try{k(q.size);var r=g('<tr id="'+q.id+'"><td class="fileName">'+q.name+'</td><td class="fileSize">'+a(q.size)+'</td><td class="fileStatus">Ready to Upload</td><td class="fileRemove"><button type="button" class="removeFileBtn" /></td></tr>');g(r).css("display","none").hover(function(){if(!g(this).hasClass("dim")){g(this).addClass("hover")}},function(){if(!g(this).hasClass("dim")){g(this).removeClass("hover")}});g(r).insertBefore(D.elmEmptyRow);g("#"+q.id+" .removeFileBtn").click(function(){O(g(this).parents("tr"))});g("#"+q.id).fadeIn("slow");if(g(".fluid-uploader-queue tbody").height()>Z.queueListMaxHeight){g(".fluid-uploader-queue tbody").height(Z.queueListMaxHeight)}n();G();Q()}catch(p){this.debug(p)}}function A(){try{}catch(p){this.debug(p)}}function X(r,q){try{f.currCount=0;f.currTotalBytes=0;f.totalCount=T();S();l()}catch(p){this.debug(p)}}function d(r,p,s){try{var u="";switch(p){case SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:u="QUEUE LIMIT EXCEEDED";break;case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:u="FILE EXCEEDS SIZE LIMIT";break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:u="ZERO BYTE FILE";break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:u="INVALID FILE TYPE";break;default:u="UNKNOWN";break}var t=u+":File ID: "+(typeof (r)==="object"&&r!==null?r.id:"na")+":"+s;debug("error_string = "+t)}catch(q){this.debug(q)}}var H=function(p){f.currError="";f.currCount++;L(0,p.name,0,f.currCount,f.totalCount);debug("Starting Upload: "+f.currCount+" ("+p.id+") ["+p.size+"] "+p.name+"")};var M=function(r,p,s){f.currError="";try{switch(p){case SWFUpload.UPLOAD_ERROR.HTTP_ERROR:f.currError="Error Code: HTTP Error, File name: "+r.name+", Message: "+s;break;case SWFUpload.UPLOAD_ERROR.UPLOAD_FAILED:f.currError="Error Code: Upload Failed, File name: "+r.name+", File size: "+r.size+", Message: "+s;break;case SWFUpload.UPLOAD_ERROR.IO_ERROR:f.currError="Error Code: IO Error, File name: "+r.name+", Message: "+s;break;case SWFUpload.UPLOAD_ERROR.SECURITY_ERROR:f.currError="Error Code: Security Error, File name: "+r.name+", Message: "+s;break;case SWFUpload.UPLOAD_ERROR.UPLOAD_LIMIT_EXCEEDED:f.currError="Error Code: Upload Limit Exceeded, File name: "+r.name+", File size: "+r.size+", Message: "+s;break;case SWFUpload.UPLOAD_ERROR.FILE_VALIDATION_FAILED:f.currError="Error Code: File Validation Failed, File name: "+r.name+", File size: "+r.size+", Message: "+s;break;case SWFUpload.UPLOAD_ERROR.FILE_CANCELLED:if(this.getStats().files_queued===0){document.getElementById(this.customSettings.cancelButtonId).disabled=true}progress.SetStatus("Cancelled");progress.SetCancelled();break;case SWFUpload.UPLOAD_ERROR.UPLOAD_STOPPED:f.currError="Upload Stopped by user input";progress.SetStatus("Stopped");h(true);break;default:progress.SetStatus("Unhandled Error: "+p);f.currError="Error Code: "+p+", File name: "+r.name+", File size: "+r.size+", Message: "+s;break}debug(f.currError)}catch(q){this.debug(q)}};var P=function(q,p,r){debug("File Status :: bytes = "+p+" :: totalBytes = "+r);debug("Total Status :: currBytes = "+(f.currTotalBytes+p)+" :: totalBytes = "+k());L(N(p,r),q.name,N(f.currTotalBytes+p,k()),f.currCount,f.totalCount)};var C=function(p){if(!f.currError){if((p.index+1)==f.totalCount){L(100,p.name,100,f.totalCount,f.totalCount);E()}else{f.currTotalBytes+=p.size;L(100,p.name);swfObj.startUpload()}U(g("tr#"+p.id))}else{debug(f.currError);h(true)}};var E=function(){n("done");h(false);if(Z.continueAfterUpload){Y(Z.whenDone)}};var k=function(p){if(typeof p=="number"){f.totalBytes+=p}return f.totalBytes};var J=function(){if(navigator.appVersion.indexOf("Win")!=-1){return"Windows"}if(navigator.appVersion.indexOf("Mac")!=-1){return"MacOS"}if(navigator.appVersion.indexOf("X11")!=-1){return"UNIX"}if(navigator.appVersion.indexOf("Linux")!=-1){return"Linux"}else{return"unknown"}};function T(){return o()-B()}function o(){return g('.fluid-uploader-queue tbody tr:not(".fluid-uploader-row-placeholder")').length}function B(){return g(".fluid-uploader-queue tbody tr.dim").length}function N(p,q){return Math.round((p*100)/q)}function a(p){return Math.round(p/1028)+" KB"}var L=function(u,v,p,r,s){var q='<span class="file_name">'+v+'</span> :: <span class="percent">'+u+"</span>% complete";c.Progress.update(D.progress,D.fileProgress,u,q);if(p){var t='Total Progress: <span class="percent">'+p+'</span>% [<span class="file_index">'+r+'</span> of <span class="total_file_num">'+s+"</span> files]";c.Progress.update(D.progress,D.totalProgress,p,t)}};var h=function(p){p=(p)?true:false;c.Progress.hide(D.progress,p)};function l(){debug("\n status.totalBytes = "+k()+"\n status.totalCount = "+f.totalCount+"\n status.currCount = "+f.currCount+"\n status.currTotalBytes = "+f.currTotalBytes+"\n status.currError = "+f.currError)}var W={};var e=function(){debug(T());if(f.stop===true){k(-f.currTotalBytes);Q();G();K()}else{if(T()){W.bytes=0;W.byteChunk=200000;W.row=g('.fluid-uploader-queue tbody tr:not(".fluid-uploader-placeholder"):not(".dim)').eq(0);W.fileId=jQuery(W.row).attr("id");W.fileObj=swfObj.getFile(W.fileId);W.bytes=0;W.totalBytes=W.fileObj.size;W.numChunks=Math.ceil(W.totalBytes/W.byteChunk);debug("DEMO :: "+W.fileId+" :: totalBytes = "+W.totalBytes+" numChunks = "+W.numChunks);H(W.fileObj);m()}else{E()}}};var m=function(){if(f.stop===true){K()}else{var p=Math.floor(Math.random()*5000+1)>1;var q=(W.bytes+W.byteChunk);if(q<W.totalBytes){debug("tmpBytes = "+q+" totalBytes = "+W.totalBytes);P(W.fileObj,q,W.totalBytes);W.bytes=q;var r=setTimeout(m,p)}else{P(W.fileObj,W.totalBytes,W.totalBytes);var s=setTimeout(i,p)}}};function i(){var q=g("tr#"+W.fileObj.id);U(q);f.currTotalBytes+=W.fileObj.size;G();Q();var p=setTimeout(e,1200)}function K(){h(true);f.stop=false;f.currCount=0;f.currTotalBytes=0;f.totalCount=T()}c.uploader={};c.uploader.init=function(q){Z=g.extend({},V,q);var p={upload_url:Z.uploadUrl,flash_url:Z.flashUrl,post_params:Z.postParams,file_size_limit:Z.fileSizeLimit,file_types:Z.fileTypes,file_types_description:Z.fileTypesDescription,file_upload_limit:Z.fileUploadLimit,file_queue_limit:Z.fileQueueLimit,file_dialog_start_handler:A,file_queued_handler:R,file_queue_error_handler:d,file_dialog_complete_handler:X,upload_start_handler:H,upload_progress_handler:P,upload_complete_handler:C,upload_error_handler:M,debug:Z.debug};if(typeof (SWFUpload)==="undefined"){return }swfObj=new SWFUpload(p);if(J()=="MacOS"){g(D.osModifierKey).text(b.macControlKey)}g(D.elmBrowse).click(function(){if(Z.fileQueueLimit===1){return swfObj.selectFile()}else{return swfObj.selectFiles()}});g(D.elmUpload).click(function(){if(f.totalCount>0){F()}});g(D.elmPause).click(function(){swfObj.stopUpload()});g(D.elmDone).click(function(){Y(Z.whenDone)});g(D.elmCancel).click(function(){Y(Z.whenCancel)});if(Z.uploadUrl===""){swfObj.startUpload=function(){e()};swfObj.stopUpload=function(){f.stop=true}}};c.uploader.test=function(){var p="";for(key in Z){p+=key+" = "+Z[key]+"\n"}for(key in D){p+=key+" = "+D[key]+"\n"}debug(p)}})(jQuery,fluid);fluid.Progress=function(C){var A=0;C(document).ready(function(){C(".progress-mask").css("opacity",0.8);C(".progress-mask-btm").height(C(".fluid-progress").height()-14)});function B(E,D){E.animate({width:D,queue:false},200)}return{update:function(F,J,H,I,K){var E=H+"%";var D=C(F+" "+J+" .progress-label");var G=C(F+" "+J+" .progress-indicator");if(K){var L=C(F+" "+J+" .progress-text");L.html(K)}if(C(F).css("display")==="none"){C(F).fadeIn("slow")}debug("percent = "+H+" lastPercent = "+A);D.html(I);G.queue("fx",[]);if(H===0){G.width(1)}else{if(H<A){G.width(E)}else{G.animate({width:E,queue:false},200)}}A=H},hide:function(G,D){var F=1600;if(D){C(G).fadeOut("slow")}else{var E=setTimeout("fluid.Progress.hide('"+G+"',"+true+")",F)}},show:function(D){C(D).fadeIn("slow")}}}(jQuery);function debug(A){if(window.console){console.log(A)}};